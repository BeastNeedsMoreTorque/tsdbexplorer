<%= content_for :script do %>
 <script type="text/javascript">
  $(document).ready( function() {
   $("tr:nth-child(odd)").addClass("odd");
   $('div.twisty').twisty();
  });
 </script>
<% end %>

<h1>Trains at <%= tidy_text(@location.tps_description) %></h1>
<h2>Between <%= @range[:from].to_s(:iso) %> and <%= @range[:to].to_s(:iso) %></h2>

<div class="twisty closed">
 <div>Technical information about this location</div>
 <div>
  <table>
   <tr>
    <th>TIPLOC</th>
    <th>CRS code</th>
    <th>NALCO</th>
    <th>STANOX</th>
   </tr>
   <tr>
    <td><%= @location.tiploc_code %></td>
    <td><%= @location.crs_code %></td>
    <td><%= @location.nalco %></td>
    <td><%= @location.stanox %></td>
   </tr>
  </table>
 </div>
</div>

<table>
 <tr>
  <th>ID</th>
  <th>Arrival</th>
  <th>Pfm</th>
  <th>From</th>
  <th>Pass</th>
  <th>To</th>
  <th>Departure</th>
  <th>Activity</th>
 </tr>

 <% @schedule.sort { |a,b| TSDBExplorer::train_sort(a,b) }.each do |train| %>
  <% if train.nil? %>
   <tr>
    <td colspan="8" style="background: #c44; color: white; font-weight: bold; text-align: center;">ERROR: Schedule <%= train.daily_schedule_uuid %> not found</td>
   </tr>
  <% else %>
   <tr>
    <td><%= link_to train.basic_schedule.train_identity, { :controller => 'schedule', :uuid => train.basic_schedule.uuid } %></td>
    <td><%= train.arrival %></td>
    <td><%= train.platform %></td>
    <td><%= tidy_text(decode_tiploc(train.basic_schedule.origin)) %></td>
    <td><%= train.pass %></td>
    <td><%= tidy_text(decode_tiploc(train.basic_schedule.terminate)) %></td>
    <td><%= train.departure %></td>
    <td>
     <% if train.activity == "TB" %>Starts here<% end %>
     <% if train.activity == "TF" %>Terminates here<% end %>
    </td>
   </tr>
  <% end %>
 <% end %>
</table>
