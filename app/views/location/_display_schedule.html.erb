<% schedule.sort { |a,b| TSDBExplorer::train_sort(a,b) }.each do |s| %>
  <%= tag 'tr', { :style => s.basic_schedule.atoc_code == "ZZ" ? 'background: #eee;' : nil }, 'open' %>
  <% if advanced_mode? %>
   <td><%= link_to (image_tag 'information.png', :alt => 'Information', :style => 'info_button'), { :controller => 'schedule', :action => 'schedule_by_uid_and_run_date', :uid => s.basic_schedule.train_uid, :year => datetime.year, :month => datetime.month, :day => datetime.day } %> <%= s.basic_schedule.train_identity %><br /><span class="label"><%= decode_stp_indicator(s.basic_schedule, :A) %></span></td>
   <td>
    <% if s.public_arrival %>Pub: <%= s.public_arrival %><% end %>
    <% if s.public_arrival && s.arrival %><br /><% end %>
    <% if s.arrival %>WTT: <%= raw tidy_wtt_time(s.arrival) %><% end %>
   </td>
   <td><%= tidy_text(decode_tiploc(s.basic_schedule.origin)) %></td>
   <td><%= format_platform_and_line(s) %>
   <td><%= tidy_text(decode_tiploc(s.basic_schedule.terminate)) %></td>
   <td>
    <% if s.public_departure %>Pub: <%= s.public_departure %><% end %>
    <% if s.public_departure && s.departure %><br /><% end %>
    <% if s.departure %>WTT: <%= raw tidy_wtt_time(s.departure) %><% end %>
   </td>
   <td><%= s.basic_schedule.atoc_code %></td>
  <% else %>
  <td><%= link_to (image_tag 'information.png', :alt => 'Information', :style => 'info_button'), :controller => 'schedule', :action => 'schedule_by_uid_and_run_date', :uid => s.basic_schedule.train_uid, :year => datetime.year, :month => datetime.month, :day => datetime.day %>
   <% if @realtime.member? s.basic_schedule_uuid %>&nbsp;<%= image_tag 'tick.png', :alt => 'Real-time information available' %><% end %>
  </td>
  <td><%= s.public_arrival %></td>
  <td><%= tidy_text(decode_tiploc(s.basic_schedule.origin)) %></td>
  <td><%= s.platform %></td>
  <td><%= tidy_text(decode_tiploc(s.basic_schedule.terminate)) %></td>
  <td><%= s.public_departure %></td>
  <td><%= decode_toc(s.basic_schedule.atoc_code) %></td>
 </tr>
 <% end %>
<% end %>
